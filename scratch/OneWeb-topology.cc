#include "ns3/core-module.h"
#include "ns3/network-module.h"
#include "ns3/mobility-module.h"
#include <string>
#include <fstream>


using namespace ns3;

// 根据ISL的状态进行快照
void
newSnapshotWay(NodeContainer nodes, double simulatorLastTime, double T){
	std::set<double> s;
	for (NodeContainer::Iterator j = nodes.Begin ();j != nodes.End (); ++j){
	      Ptr<Node> object = *j;
	      Ptr<LEOSatelliteMobilityModel> mobility = object->GetObject<LEOSatelliteMobilityModel> ();
	      double enterNorthPoleTime = mobility->m_helper.getEnterNorthPoleTime();
	      while (enterNorthPoleTime <= simulatorLastTime) {
	    	  s.insert(enterNorthPoleTime);
	    	  enterNorthPoleTime = enterNorthPoleTime + T;
	      }
	      double enterSorthPoleTime = mobility->m_helper.getEnterSorthPoleTime();
	      while (enterSorthPoleTime <= simulatorLastTime) {
	    	  s.insert(enterSorthPoleTime);
	    	  enterSorthPoleTime = enterSorthPoleTime + T;
	      }
	      double leaveNorthPoleTime = mobility->m_helper.getLeaveNorthPoleTime();
		  while (leaveNorthPoleTime <= simulatorLastTime) {
			  s.insert(leaveNorthPoleTime);
			  leaveNorthPoleTime = leaveNorthPoleTime + T;
		  }
		  double leaveSorthPoleTime = mobility->m_helper.getLeaveSorthPoleTime();
		  while (leaveSorthPoleTime <= simulatorLastTime) {
			  s.insert(leaveSorthPoleTime);
			  leaveSorthPoleTime = leaveSorthPoleTime + T;
		  }
	}
	std::cout<<"newSnapshotWay: set.size= "<< s.size() << std::endl;
	std::set<double>::iterator iter;
    for(iter = s.begin() ; iter != s.end() ; ++iter){
         std::cout<<*iter<<" ";
     }
    std::cout<<std::endl;
	for (NodeContainer::Iterator j = nodes.Begin ();j != nodes.End (); ++j){
	      Ptr<Node> object = *j;
	      Ptr<LEOSatelliteMobilityModel> mobility = object->GetObject<LEOSatelliteMobilityModel> ();
	      for(iter = s.begin() ; iter != s.end() ; ++iter){
	 		  Simulator::Schedule (Seconds (*iter+0.01), &LEOSatelliteMobilityModel::UpdatePosition, mobility);
	       }
	}
}

// //Prints actual position and velocity when a course change event occurs
//static void
//CourseChange (std::string foo, Ptr<const MobilityModel> mobility)
//{
//  Vector pos = mobility->GetPosition ();
//  std::string file_name = "OneWeb-topology.txt";
//  std::ofstream file_writer(file_name, std::ios::app);//打开file_name文件，以ios::app追加的方式输入
//  file_writer << "time:" << Simulator::Now () << std::endl;
//  file_writer << pos.x << " " << pos.y << " " << pos.z << std::endl;
//  file_writer.close();
//
//}

int main (int argc, char *argv[])
{
  CommandLine cmd;
  cmd.Parse (argc, argv);

  const double ALTITUDE = 1200;//卫星海拔
  const double INCLINATION = 87.9;//倾角

  // 720颗将被发射到倾角为87.9°的1200km高度轨道，均匀分布在18个轨道面 ，每个轨道面工作星36颗，辅以4颗备份星
//  double iridiumConstellation[18][40][4] = {{{0,0,0.0,0},{1,0,9.0,0},{2,0,18.0,0},{3,0,27.0,0},{4,0,36.0,0},{5,0,45.0,0},{6,0,54.0,0},{7,0,63.0,0},{8,0,72.0,0},{9,0,81.0,0},{10,0,90.0,0},{11,0,99.0,0},{12,0,108.0,0},{13,0,117.0,0},{14,0,126.0,0},{15,0,135.0,0},{16,0,144.0,0},{17,0,153.0,0},{18,0,162.0,0},{19,0,171.0,0},{20,0,180.0,0},{21,0,189.0,0},{22,0,198.0,0},{23,0,207.0,0},{24,0,216.0,0},{25,0,225.0,0},{26,0,234.0,0},{27,0,243.0,0},{28,0,252.0,0},{29,0,261.0,0},{30,0,270.0,0},{31,0,279.0,0},{32,0,288.0,0},{33,0,297.0,0},{34,0,306.0,0},{35,0,315.0,0},{36,0,324.0,0},{37,0,333.0,0},{38,0,342.0,0},{39,0,351.0,0}},{{40,10,0.0,1},{41,10,9.0,1},{42,10,18.0,1},{43,10,27.0,1},{44,10,36.0,1},{45,10,45.0,1},{46,10,54.0,1},{47,10,63.0,1},{48,10,72.0,1},{49,10,81.0,1},{50,10,90.0,1},{51,10,99.0,1},{52,10,108.0,1},{53,10,117.0,1},{54,10,126.0,1},{55,10,135.0,1},{56,10,144.0,1},{57,10,153.0,1},{58,10,162.0,1},{59,10,171.0,1},{60,10,180.0,1},{61,10,189.0,1},{62,10,198.0,1},{63,10,207.0,1},{64,10,216.0,1},{65,10,225.0,1},{66,10,234.0,1},{67,10,243.0,1},{68,10,252.0,1},{69,10,261.0,1},{70,10,270.0,1},{71,10,279.0,1},{72,10,288.0,1},{73,10,297.0,1},{74,10,306.0,1},{75,10,315.0,1},{76,10,324.0,1},{77,10,333.0,1},{78,10,342.0,1},{79,10,351.0,1}},{{80,20,0.0,2},{81,20,9.0,2},{82,20,18.0,2},{83,20,27.0,2},{84,20,36.0,2},{85,20,45.0,2},{86,20,54.0,2},{87,20,63.0,2},{88,20,72.0,2},{89,20,81.0,2},{90,20,90.0,2},{91,20,99.0,2},{92,20,108.0,2},{93,20,117.0,2},{94,20,126.0,2},{95,20,135.0,2},{96,20,144.0,2},{97,20,153.0,2},{98,20,162.0,2},{99,20,171.0,2},{100,20,180.0,2},{101,20,189.0,2},{102,20,198.0,2},{103,20,207.0,2},{104,20,216.0,2},{105,20,225.0,2},{106,20,234.0,2},{107,20,243.0,2},{108,20,252.0,2},{109,20,261.0,2},{110,20,270.0,2},{111,20,279.0,2},{112,20,288.0,2},{113,20,297.0,2},{114,20,306.0,2},{115,20,315.0,2},{116,20,324.0,2},{117,20,333.0,2},{118,20,342.0,2},{119,20,351.0,2}},{{120,30,0.0,3},{121,30,9.0,3},{122,30,18.0,3},{123,30,27.0,3},{124,30,36.0,3},{125,30,45.0,3},{126,30,54.0,3},{127,30,63.0,3},{128,30,72.0,3},{129,30,81.0,3},{130,30,90.0,3},{131,30,99.0,3},{132,30,108.0,3},{133,30,117.0,3},{134,30,126.0,3},{135,30,135.0,3},{136,30,144.0,3},{137,30,153.0,3},{138,30,162.0,3},{139,30,171.0,3},{140,30,180.0,3},{141,30,189.0,3},{142,30,198.0,3},{143,30,207.0,3},{144,30,216.0,3},{145,30,225.0,3},{146,30,234.0,3},{147,30,243.0,3},{148,30,252.0,3},{149,30,261.0,3},{150,30,270.0,3},{151,30,279.0,3},{152,30,288.0,3},{153,30,297.0,3},{154,30,306.0,3},{155,30,315.0,3},{156,30,324.0,3},{157,30,333.0,3},{158,30,342.0,3},{159,30,351.0,3}},{{160,40,0.0,4},{161,40,9.0,4},{162,40,18.0,4},{163,40,27.0,4},{164,40,36.0,4},{165,40,45.0,4},{166,40,54.0,4},{167,40,63.0,4},{168,40,72.0,4},{169,40,81.0,4},{170,40,90.0,4},{171,40,99.0,4},{172,40,108.0,4},{173,40,117.0,4},{174,40,126.0,4},{175,40,135.0,4},{176,40,144.0,4},{177,40,153.0,4},{178,40,162.0,4},{179,40,171.0,4},{180,40,180.0,4},{181,40,189.0,4},{182,40,198.0,4},{183,40,207.0,4},{184,40,216.0,4},{185,40,225.0,4},{186,40,234.0,4},{187,40,243.0,4},{188,40,252.0,4},{189,40,261.0,4},{190,40,270.0,4},{191,40,279.0,4},{192,40,288.0,4},{193,40,297.0,4},{194,40,306.0,4},{195,40,315.0,4},{196,40,324.0,4},{197,40,333.0,4},{198,40,342.0,4},{199,40,351.0,4}},{{200,50,0.0,5},{201,50,9.0,5},{202,50,18.0,5},{203,50,27.0,5},{204,50,36.0,5},{205,50,45.0,5},{206,50,54.0,5},{207,50,63.0,5},{208,50,72.0,5},{209,50,81.0,5},{210,50,90.0,5},{211,50,99.0,5},{212,50,108.0,5},{213,50,117.0,5},{214,50,126.0,5},{215,50,135.0,5},{216,50,144.0,5},{217,50,153.0,5},{218,50,162.0,5},{219,50,171.0,5},{220,50,180.0,5},{221,50,189.0,5},{222,50,198.0,5},{223,50,207.0,5},{224,50,216.0,5},{225,50,225.0,5},{226,50,234.0,5},{227,50,243.0,5},{228,50,252.0,5},{229,50,261.0,5},{230,50,270.0,5},{231,50,279.0,5},{232,50,288.0,5},{233,50,297.0,5},{234,50,306.0,5},{235,50,315.0,5},{236,50,324.0,5},{237,50,333.0,5},{238,50,342.0,5},{239,50,351.0,5}},{{240,60,0.0,6},{241,60,9.0,6},{242,60,18.0,6},{243,60,27.0,6},{244,60,36.0,6},{245,60,45.0,6},{246,60,54.0,6},{247,60,63.0,6},{248,60,72.0,6},{249,60,81.0,6},{250,60,90.0,6},{251,60,99.0,6},{252,60,108.0,6},{253,60,117.0,6},{254,60,126.0,6},{255,60,135.0,6},{256,60,144.0,6},{257,60,153.0,6},{258,60,162.0,6},{259,60,171.0,6},{260,60,180.0,6},{261,60,189.0,6},{262,60,198.0,6},{263,60,207.0,6},{264,60,216.0,6},{265,60,225.0,6},{266,60,234.0,6},{267,60,243.0,6},{268,60,252.0,6},{269,60,261.0,6},{270,60,270.0,6},{271,60,279.0,6},{272,60,288.0,6},{273,60,297.0,6},{274,60,306.0,6},{275,60,315.0,6},{276,60,324.0,6},{277,60,333.0,6},{278,60,342.0,6},{279,60,351.0,6}},{{280,70,0.0,7},{281,70,9.0,7},{282,70,18.0,7},{283,70,27.0,7},{284,70,36.0,7},{285,70,45.0,7},{286,70,54.0,7},{287,70,63.0,7},{288,70,72.0,7},{289,70,81.0,7},{290,70,90.0,7},{291,70,99.0,7},{292,70,108.0,7},{293,70,117.0,7},{294,70,126.0,7},{295,70,135.0,7},{296,70,144.0,7},{297,70,153.0,7},{298,70,162.0,7},{299,70,171.0,7},{300,70,180.0,7},{301,70,189.0,7},{302,70,198.0,7},{303,70,207.0,7},{304,70,216.0,7},{305,70,225.0,7},{306,70,234.0,7},{307,70,243.0,7},{308,70,252.0,7},{309,70,261.0,7},{310,70,270.0,7},{311,70,279.0,7},{312,70,288.0,7},{313,70,297.0,7},{314,70,306.0,7},{315,70,315.0,7},{316,70,324.0,7},{317,70,333.0,7},{318,70,342.0,7},{319,70,351.0,7}},{{320,80,0.0,8},{321,80,9.0,8},{322,80,18.0,8},{323,80,27.0,8},{324,80,36.0,8},{325,80,45.0,8},{326,80,54.0,8},{327,80,63.0,8},{328,80,72.0,8},{329,80,81.0,8},{330,80,90.0,8},{331,80,99.0,8},{332,80,108.0,8},{333,80,117.0,8},{334,80,126.0,8},{335,80,135.0,8},{336,80,144.0,8},{337,80,153.0,8},{338,80,162.0,8},{339,80,171.0,8},{340,80,180.0,8},{341,80,189.0,8},{342,80,198.0,8},{343,80,207.0,8},{344,80,216.0,8},{345,80,225.0,8},{346,80,234.0,8},{347,80,243.0,8},{348,80,252.0,8},{349,80,261.0,8},{350,80,270.0,8},{351,80,279.0,8},{352,80,288.0,8},{353,80,297.0,8},{354,80,306.0,8},{355,80,315.0,8},{356,80,324.0,8},{357,80,333.0,8},{358,80,342.0,8},{359,80,351.0,8}},{{360,90,0.0,9},{361,90,9.0,9},{362,90,18.0,9},{363,90,27.0,9},{364,90,36.0,9},{365,90,45.0,9},{366,90,54.0,9},{367,90,63.0,9},{368,90,72.0,9},{369,90,81.0,9},{370,90,90.0,9},{371,90,99.0,9},{372,90,108.0,9},{373,90,117.0,9},{374,90,126.0,9},{375,90,135.0,9},{376,90,144.0,9},{377,90,153.0,9},{378,90,162.0,9},{379,90,171.0,9},{380,90,180.0,9},{381,90,189.0,9},{382,90,198.0,9},{383,90,207.0,9},{384,90,216.0,9},{385,90,225.0,9},{386,90,234.0,9},{387,90,243.0,9},{388,90,252.0,9},{389,90,261.0,9},{390,90,270.0,9},{391,90,279.0,9},{392,90,288.0,9},{393,90,297.0,9},{394,90,306.0,9},{395,90,315.0,9},{396,90,324.0,9},{397,90,333.0,9},{398,90,342.0,9},{399,90,351.0,9}},{{400,100,0.0,10},{401,100,9.0,10},{402,100,18.0,10},{403,100,27.0,10},{404,100,36.0,10},{405,100,45.0,10},{406,100,54.0,10},{407,100,63.0,10},{408,100,72.0,10},{409,100,81.0,10},{410,100,90.0,10},{411,100,99.0,10},{412,100,108.0,10},{413,100,117.0,10},{414,100,126.0,10},{415,100,135.0,10},{416,100,144.0,10},{417,100,153.0,10},{418,100,162.0,10},{419,100,171.0,10},{420,100,180.0,10},{421,100,189.0,10},{422,100,198.0,10},{423,100,207.0,10},{424,100,216.0,10},{425,100,225.0,10},{426,100,234.0,10},{427,100,243.0,10},{428,100,252.0,10},{429,100,261.0,10},{430,100,270.0,10},{431,100,279.0,10},{432,100,288.0,10},{433,100,297.0,10},{434,100,306.0,10},{435,100,315.0,10},{436,100,324.0,10},{437,100,333.0,10},{438,100,342.0,10},{439,100,351.0,10}},{{440,110,0.0,11},{441,110,9.0,11},{442,110,18.0,11},{443,110,27.0,11},{444,110,36.0,11},{445,110,45.0,11},{446,110,54.0,11},{447,110,63.0,11},{448,110,72.0,11},{449,110,81.0,11},{450,110,90.0,11},{451,110,99.0,11},{452,110,108.0,11},{453,110,117.0,11},{454,110,126.0,11},{455,110,135.0,11},{456,110,144.0,11},{457,110,153.0,11},{458,110,162.0,11},{459,110,171.0,11},{460,110,180.0,11},{461,110,189.0,11},{462,110,198.0,11},{463,110,207.0,11},{464,110,216.0,11},{465,110,225.0,11},{466,110,234.0,11},{467,110,243.0,11},{468,110,252.0,11},{469,110,261.0,11},{470,110,270.0,11},{471,110,279.0,11},{472,110,288.0,11},{473,110,297.0,11},{474,110,306.0,11},{475,110,315.0,11},{476,110,324.0,11},{477,110,333.0,11},{478,110,342.0,11},{479,110,351.0,11}},{{480,120,0.0,12},{481,120,9.0,12},{482,120,18.0,12},{483,120,27.0,12},{484,120,36.0,12},{485,120,45.0,12},{486,120,54.0,12},{487,120,63.0,12},{488,120,72.0,12},{489,120,81.0,12},{490,120,90.0,12},{491,120,99.0,12},{492,120,108.0,12},{493,120,117.0,12},{494,120,126.0,12},{495,120,135.0,12},{496,120,144.0,12},{497,120,153.0,12},{498,120,162.0,12},{499,120,171.0,12},{500,120,180.0,12},{501,120,189.0,12},{502,120,198.0,12},{503,120,207.0,12},{504,120,216.0,12},{505,120,225.0,12},{506,120,234.0,12},{507,120,243.0,12},{508,120,252.0,12},{509,120,261.0,12},{510,120,270.0,12},{511,120,279.0,12},{512,120,288.0,12},{513,120,297.0,12},{514,120,306.0,12},{515,120,315.0,12},{516,120,324.0,12},{517,120,333.0,12},{518,120,342.0,12},{519,120,351.0,12}},{{520,130,0.0,13},{521,130,9.0,13},{522,130,18.0,13},{523,130,27.0,13},{524,130,36.0,13},{525,130,45.0,13},{526,130,54.0,13},{527,130,63.0,13},{528,130,72.0,13},{529,130,81.0,13},{530,130,90.0,13},{531,130,99.0,13},{532,130,108.0,13},{533,130,117.0,13},{534,130,126.0,13},{535,130,135.0,13},{536,130,144.0,13},{537,130,153.0,13},{538,130,162.0,13},{539,130,171.0,13},{540,130,180.0,13},{541,130,189.0,13},{542,130,198.0,13},{543,130,207.0,13},{544,130,216.0,13},{545,130,225.0,13},{546,130,234.0,13},{547,130,243.0,13},{548,130,252.0,13},{549,130,261.0,13},{550,130,270.0,13},{551,130,279.0,13},{552,130,288.0,13},{553,130,297.0,13},{554,130,306.0,13},{555,130,315.0,13},{556,130,324.0,13},{557,130,333.0,13},{558,130,342.0,13},{559,130,351.0,13}},{{560,140,0.0,14},{561,140,9.0,14},{562,140,18.0,14},{563,140,27.0,14},{564,140,36.0,14},{565,140,45.0,14},{566,140,54.0,14},{567,140,63.0,14},{568,140,72.0,14},{569,140,81.0,14},{570,140,90.0,14},{571,140,99.0,14},{572,140,108.0,14},{573,140,117.0,14},{574,140,126.0,14},{575,140,135.0,14},{576,140,144.0,14},{577,140,153.0,14},{578,140,162.0,14},{579,140,171.0,14},{580,140,180.0,14},{581,140,189.0,14},{582,140,198.0,14},{583,140,207.0,14},{584,140,216.0,14},{585,140,225.0,14},{586,140,234.0,14},{587,140,243.0,14},{588,140,252.0,14},{589,140,261.0,14},{590,140,270.0,14},{591,140,279.0,14},{592,140,288.0,14},{593,140,297.0,14},{594,140,306.0,14},{595,140,315.0,14},{596,140,324.0,14},{597,140,333.0,14},{598,140,342.0,14},{599,140,351.0,14}},{{600,150,0.0,15},{601,150,9.0,15},{602,150,18.0,15},{603,150,27.0,15},{604,150,36.0,15},{605,150,45.0,15},{606,150,54.0,15},{607,150,63.0,15},{608,150,72.0,15},{609,150,81.0,15},{610,150,90.0,15},{611,150,99.0,15},{612,150,108.0,15},{613,150,117.0,15},{614,150,126.0,15},{615,150,135.0,15},{616,150,144.0,15},{617,150,153.0,15},{618,150,162.0,15},{619,150,171.0,15},{620,150,180.0,15},{621,150,189.0,15},{622,150,198.0,15},{623,150,207.0,15},{624,150,216.0,15},{625,150,225.0,15},{626,150,234.0,15},{627,150,243.0,15},{628,150,252.0,15},{629,150,261.0,15},{630,150,270.0,15},{631,150,279.0,15},{632,150,288.0,15},{633,150,297.0,15},{634,150,306.0,15},{635,150,315.0,15},{636,150,324.0,15},{637,150,333.0,15},{638,150,342.0,15},{639,150,351.0,15}},{{640,160,0.0,16},{641,160,9.0,16},{642,160,18.0,16},{643,160,27.0,16},{644,160,36.0,16},{645,160,45.0,16},{646,160,54.0,16},{647,160,63.0,16},{648,160,72.0,16},{649,160,81.0,16},{650,160,90.0,16},{651,160,99.0,16},{652,160,108.0,16},{653,160,117.0,16},{654,160,126.0,16},{655,160,135.0,16},{656,160,144.0,16},{657,160,153.0,16},{658,160,162.0,16},{659,160,171.0,16},{660,160,180.0,16},{661,160,189.0,16},{662,160,198.0,16},{663,160,207.0,16},{664,160,216.0,16},{665,160,225.0,16},{666,160,234.0,16},{667,160,243.0,16},{668,160,252.0,16},{669,160,261.0,16},{670,160,270.0,16},{671,160,279.0,16},{672,160,288.0,16},{673,160,297.0,16},{674,160,306.0,16},{675,160,315.0,16},{676,160,324.0,16},{677,160,333.0,16},{678,160,342.0,16},{679,160,351.0,16}},{{680,170,0.0,17},{681,170,9.0,17},{682,170,18.0,17},{683,170,27.0,17},{684,170,36.0,17},{685,170,45.0,17},{686,170,54.0,17},{687,170,63.0,17},{688,170,72.0,17},{689,170,81.0,17},{690,170,90.0,17},{691,170,99.0,17},{692,170,108.0,17},{693,170,117.0,17},{694,170,126.0,17},{695,170,135.0,17},{696,170,144.0,17},{697,170,153.0,17},{698,170,162.0,17},{699,170,171.0,17},{700,170,180.0,17},{701,170,189.0,17},{702,170,198.0,17},{703,170,207.0,17},{704,170,216.0,17},{705,170,225.0,17},{706,170,234.0,17},{707,170,243.0,17},{708,170,252.0,17},{709,170,261.0,17},{710,170,270.0,17},{711,170,279.0,17},{712,170,288.0,17},{713,170,297.0,17},{714,170,306.0,17},{715,170,315.0,17},{716,170,324.0,17},{717,170,333.0,17},{718,170,342.0,17},{719,170,351.0,17}}};
  double iridiumConstellation[18][40][4] = {{{0,0,0.0,0},{1,0,9.0,0},{2,0,18.0,0},{3,0,27.0,0},{4,0,36.0,0},{5,0,45.0,0},{6,0,54.0,0},{7,0,63.0,0},{8,0,72.0,0},{9,0,81.0,0},{10,0,90.0,0},{11,0,99.0,0},{12,0,108.0,0},{13,0,117.0,0},{14,0,126.0,0},{15,0,135.0,0},{16,0,144.0,0},{17,0,153.0,0},{18,0,162.0,0},{19,0,171.0,0},{20,0,180.0,0},{21,0,189.0,0},{22,0,198.0,0},{23,0,207.0,0},{24,0,216.0,0},{25,0,225.0,0},{26,0,234.0,0},{27,0,243.0,0},{28,0,252.0,0},{29,0,261.0,0},{30,0,270.0,0},{31,0,279.0,0},{32,0,288.0,0},{33,0,297.0,0},{34,0,306.0,0},{35,0,315.0,0},{36,0,324.0,0},{37,0,333.0,0},{38,0,342.0,0},{39,0,351.0,0}},{{40,10,4.5,1},{41,10,13.5,1},{42,10,22.5,1},{43,10,31.5,1},{44,10,40.5,1},{45,10,49.5,1},{46,10,58.5,1},{47,10,67.5,1},{48,10,76.5,1},{49,10,85.5,1},{50,10,94.5,1},{51,10,103.5,1},{52,10,112.5,1},{53,10,121.5,1},{54,10,130.5,1},{55,10,139.5,1},{56,10,148.5,1},{57,10,157.5,1},{58,10,166.5,1},{59,10,175.5,1},{60,10,184.5,1},{61,10,193.5,1},{62,10,202.5,1},{63,10,211.5,1},{64,10,220.5,1},{65,10,229.5,1},{66,10,238.5,1},{67,10,247.5,1},{68,10,256.5,1},{69,10,265.5,1},{70,10,274.5,1},{71,10,283.5,1},{72,10,292.5,1},{73,10,301.5,1},{74,10,310.5,1},{75,10,319.5,1},{76,10,328.5,1},{77,10,337.5,1},{78,10,346.5,1},{79,10,355.5,1}},{{80,20,0.0,2},{81,20,9.0,2},{82,20,18.0,2},{83,20,27.0,2},{84,20,36.0,2},{85,20,45.0,2},{86,20,54.0,2},{87,20,63.0,2},{88,20,72.0,2},{89,20,81.0,2},{90,20,90.0,2},{91,20,99.0,2},{92,20,108.0,2},{93,20,117.0,2},{94,20,126.0,2},{95,20,135.0,2},{96,20,144.0,2},{97,20,153.0,2},{98,20,162.0,2},{99,20,171.0,2},{100,20,180.0,2},{101,20,189.0,2},{102,20,198.0,2},{103,20,207.0,2},{104,20,216.0,2},{105,20,225.0,2},{106,20,234.0,2},{107,20,243.0,2},{108,20,252.0,2},{109,20,261.0,2},{110,20,270.0,2},{111,20,279.0,2},{112,20,288.0,2},{113,20,297.0,2},{114,20,306.0,2},{115,20,315.0,2},{116,20,324.0,2},{117,20,333.0,2},{118,20,342.0,2},{119,20,351.0,2}},{{120,30,4.5,3},{121,30,13.5,3},{122,30,22.5,3},{123,30,31.5,3},{124,30,40.5,3},{125,30,49.5,3},{126,30,58.5,3},{127,30,67.5,3},{128,30,76.5,3},{129,30,85.5,3},{130,30,94.5,3},{131,30,103.5,3},{132,30,112.5,3},{133,30,121.5,3},{134,30,130.5,3},{135,30,139.5,3},{136,30,148.5,3},{137,30,157.5,3},{138,30,166.5,3},{139,30,175.5,3},{140,30,184.5,3},{141,30,193.5,3},{142,30,202.5,3},{143,30,211.5,3},{144,30,220.5,3},{145,30,229.5,3},{146,30,238.5,3},{147,30,247.5,3},{148,30,256.5,3},{149,30,265.5,3},{150,30,274.5,3},{151,30,283.5,3},{152,30,292.5,3},{153,30,301.5,3},{154,30,310.5,3},{155,30,319.5,3},{156,30,328.5,3},{157,30,337.5,3},{158,30,346.5,3},{159,30,355.5,3}},{{160,40,0.0,4},{161,40,9.0,4},{162,40,18.0,4},{163,40,27.0,4},{164,40,36.0,4},{165,40,45.0,4},{166,40,54.0,4},{167,40,63.0,4},{168,40,72.0,4},{169,40,81.0,4},{170,40,90.0,4},{171,40,99.0,4},{172,40,108.0,4},{173,40,117.0,4},{174,40,126.0,4},{175,40,135.0,4},{176,40,144.0,4},{177,40,153.0,4},{178,40,162.0,4},{179,40,171.0,4},{180,40,180.0,4},{181,40,189.0,4},{182,40,198.0,4},{183,40,207.0,4},{184,40,216.0,4},{185,40,225.0,4},{186,40,234.0,4},{187,40,243.0,4},{188,40,252.0,4},{189,40,261.0,4},{190,40,270.0,4},{191,40,279.0,4},{192,40,288.0,4},{193,40,297.0,4},{194,40,306.0,4},{195,40,315.0,4},{196,40,324.0,4},{197,40,333.0,4},{198,40,342.0,4},{199,40,351.0,4}},{{200,50,4.5,5},{201,50,13.5,5},{202,50,22.5,5},{203,50,31.5,5},{204,50,40.5,5},{205,50,49.5,5},{206,50,58.5,5},{207,50,67.5,5},{208,50,76.5,5},{209,50,85.5,5},{210,50,94.5,5},{211,50,103.5,5},{212,50,112.5,5},{213,50,121.5,5},{214,50,130.5,5},{215,50,139.5,5},{216,50,148.5,5},{217,50,157.5,5},{218,50,166.5,5},{219,50,175.5,5},{220,50,184.5,5},{221,50,193.5,5},{222,50,202.5,5},{223,50,211.5,5},{224,50,220.5,5},{225,50,229.5,5},{226,50,238.5,5},{227,50,247.5,5},{228,50,256.5,5},{229,50,265.5,5},{230,50,274.5,5},{231,50,283.5,5},{232,50,292.5,5},{233,50,301.5,5},{234,50,310.5,5},{235,50,319.5,5},{236,50,328.5,5},{237,50,337.5,5},{238,50,346.5,5},{239,50,355.5,5}},{{240,60,0.0,6},{241,60,9.0,6},{242,60,18.0,6},{243,60,27.0,6},{244,60,36.0,6},{245,60,45.0,6},{246,60,54.0,6},{247,60,63.0,6},{248,60,72.0,6},{249,60,81.0,6},{250,60,90.0,6},{251,60,99.0,6},{252,60,108.0,6},{253,60,117.0,6},{254,60,126.0,6},{255,60,135.0,6},{256,60,144.0,6},{257,60,153.0,6},{258,60,162.0,6},{259,60,171.0,6},{260,60,180.0,6},{261,60,189.0,6},{262,60,198.0,6},{263,60,207.0,6},{264,60,216.0,6},{265,60,225.0,6},{266,60,234.0,6},{267,60,243.0,6},{268,60,252.0,6},{269,60,261.0,6},{270,60,270.0,6},{271,60,279.0,6},{272,60,288.0,6},{273,60,297.0,6},{274,60,306.0,6},{275,60,315.0,6},{276,60,324.0,6},{277,60,333.0,6},{278,60,342.0,6},{279,60,351.0,6}},{{280,70,4.5,7},{281,70,13.5,7},{282,70,22.5,7},{283,70,31.5,7},{284,70,40.5,7},{285,70,49.5,7},{286,70,58.5,7},{287,70,67.5,7},{288,70,76.5,7},{289,70,85.5,7},{290,70,94.5,7},{291,70,103.5,7},{292,70,112.5,7},{293,70,121.5,7},{294,70,130.5,7},{295,70,139.5,7},{296,70,148.5,7},{297,70,157.5,7},{298,70,166.5,7},{299,70,175.5,7},{300,70,184.5,7},{301,70,193.5,7},{302,70,202.5,7},{303,70,211.5,7},{304,70,220.5,7},{305,70,229.5,7},{306,70,238.5,7},{307,70,247.5,7},{308,70,256.5,7},{309,70,265.5,7},{310,70,274.5,7},{311,70,283.5,7},{312,70,292.5,7},{313,70,301.5,7},{314,70,310.5,7},{315,70,319.5,7},{316,70,328.5,7},{317,70,337.5,7},{318,70,346.5,7},{319,70,355.5,7}},{{320,80,0.0,8},{321,80,9.0,8},{322,80,18.0,8},{323,80,27.0,8},{324,80,36.0,8},{325,80,45.0,8},{326,80,54.0,8},{327,80,63.0,8},{328,80,72.0,8},{329,80,81.0,8},{330,80,90.0,8},{331,80,99.0,8},{332,80,108.0,8},{333,80,117.0,8},{334,80,126.0,8},{335,80,135.0,8},{336,80,144.0,8},{337,80,153.0,8},{338,80,162.0,8},{339,80,171.0,8},{340,80,180.0,8},{341,80,189.0,8},{342,80,198.0,8},{343,80,207.0,8},{344,80,216.0,8},{345,80,225.0,8},{346,80,234.0,8},{347,80,243.0,8},{348,80,252.0,8},{349,80,261.0,8},{350,80,270.0,8},{351,80,279.0,8},{352,80,288.0,8},{353,80,297.0,8},{354,80,306.0,8},{355,80,315.0,8},{356,80,324.0,8},{357,80,333.0,8},{358,80,342.0,8},{359,80,351.0,8}},{{360,90,4.5,9},{361,90,13.5,9},{362,90,22.5,9},{363,90,31.5,9},{364,90,40.5,9},{365,90,49.5,9},{366,90,58.5,9},{367,90,67.5,9},{368,90,76.5,9},{369,90,85.5,9},{370,90,94.5,9},{371,90,103.5,9},{372,90,112.5,9},{373,90,121.5,9},{374,90,130.5,9},{375,90,139.5,9},{376,90,148.5,9},{377,90,157.5,9},{378,90,166.5,9},{379,90,175.5,9},{380,90,184.5,9},{381,90,193.5,9},{382,90,202.5,9},{383,90,211.5,9},{384,90,220.5,9},{385,90,229.5,9},{386,90,238.5,9},{387,90,247.5,9},{388,90,256.5,9},{389,90,265.5,9},{390,90,274.5,9},{391,90,283.5,9},{392,90,292.5,9},{393,90,301.5,9},{394,90,310.5,9},{395,90,319.5,9},{396,90,328.5,9},{397,90,337.5,9},{398,90,346.5,9},{399,90,355.5,9}},{{400,100,0.0,10},{401,100,9.0,10},{402,100,18.0,10},{403,100,27.0,10},{404,100,36.0,10},{405,100,45.0,10},{406,100,54.0,10},{407,100,63.0,10},{408,100,72.0,10},{409,100,81.0,10},{410,100,90.0,10},{411,100,99.0,10},{412,100,108.0,10},{413,100,117.0,10},{414,100,126.0,10},{415,100,135.0,10},{416,100,144.0,10},{417,100,153.0,10},{418,100,162.0,10},{419,100,171.0,10},{420,100,180.0,10},{421,100,189.0,10},{422,100,198.0,10},{423,100,207.0,10},{424,100,216.0,10},{425,100,225.0,10},{426,100,234.0,10},{427,100,243.0,10},{428,100,252.0,10},{429,100,261.0,10},{430,100,270.0,10},{431,100,279.0,10},{432,100,288.0,10},{433,100,297.0,10},{434,100,306.0,10},{435,100,315.0,10},{436,100,324.0,10},{437,100,333.0,10},{438,100,342.0,10},{439,100,351.0,10}},{{440,110,4.5,11},{441,110,13.5,11},{442,110,22.5,11},{443,110,31.5,11},{444,110,40.5,11},{445,110,49.5,11},{446,110,58.5,11},{447,110,67.5,11},{448,110,76.5,11},{449,110,85.5,11},{450,110,94.5,11},{451,110,103.5,11},{452,110,112.5,11},{453,110,121.5,11},{454,110,130.5,11},{455,110,139.5,11},{456,110,148.5,11},{457,110,157.5,11},{458,110,166.5,11},{459,110,175.5,11},{460,110,184.5,11},{461,110,193.5,11},{462,110,202.5,11},{463,110,211.5,11},{464,110,220.5,11},{465,110,229.5,11},{466,110,238.5,11},{467,110,247.5,11},{468,110,256.5,11},{469,110,265.5,11},{470,110,274.5,11},{471,110,283.5,11},{472,110,292.5,11},{473,110,301.5,11},{474,110,310.5,11},{475,110,319.5,11},{476,110,328.5,11},{477,110,337.5,11},{478,110,346.5,11},{479,110,355.5,11}},{{480,120,0.0,12},{481,120,9.0,12},{482,120,18.0,12},{483,120,27.0,12},{484,120,36.0,12},{485,120,45.0,12},{486,120,54.0,12},{487,120,63.0,12},{488,120,72.0,12},{489,120,81.0,12},{490,120,90.0,12},{491,120,99.0,12},{492,120,108.0,12},{493,120,117.0,12},{494,120,126.0,12},{495,120,135.0,12},{496,120,144.0,12},{497,120,153.0,12},{498,120,162.0,12},{499,120,171.0,12},{500,120,180.0,12},{501,120,189.0,12},{502,120,198.0,12},{503,120,207.0,12},{504,120,216.0,12},{505,120,225.0,12},{506,120,234.0,12},{507,120,243.0,12},{508,120,252.0,12},{509,120,261.0,12},{510,120,270.0,12},{511,120,279.0,12},{512,120,288.0,12},{513,120,297.0,12},{514,120,306.0,12},{515,120,315.0,12},{516,120,324.0,12},{517,120,333.0,12},{518,120,342.0,12},{519,120,351.0,12}},{{520,130,4.5,13},{521,130,13.5,13},{522,130,22.5,13},{523,130,31.5,13},{524,130,40.5,13},{525,130,49.5,13},{526,130,58.5,13},{527,130,67.5,13},{528,130,76.5,13},{529,130,85.5,13},{530,130,94.5,13},{531,130,103.5,13},{532,130,112.5,13},{533,130,121.5,13},{534,130,130.5,13},{535,130,139.5,13},{536,130,148.5,13},{537,130,157.5,13},{538,130,166.5,13},{539,130,175.5,13},{540,130,184.5,13},{541,130,193.5,13},{542,130,202.5,13},{543,130,211.5,13},{544,130,220.5,13},{545,130,229.5,13},{546,130,238.5,13},{547,130,247.5,13},{548,130,256.5,13},{549,130,265.5,13},{550,130,274.5,13},{551,130,283.5,13},{552,130,292.5,13},{553,130,301.5,13},{554,130,310.5,13},{555,130,319.5,13},{556,130,328.5,13},{557,130,337.5,13},{558,130,346.5,13},{559,130,355.5,13}},{{560,140,0.0,14},{561,140,9.0,14},{562,140,18.0,14},{563,140,27.0,14},{564,140,36.0,14},{565,140,45.0,14},{566,140,54.0,14},{567,140,63.0,14},{568,140,72.0,14},{569,140,81.0,14},{570,140,90.0,14},{571,140,99.0,14},{572,140,108.0,14},{573,140,117.0,14},{574,140,126.0,14},{575,140,135.0,14},{576,140,144.0,14},{577,140,153.0,14},{578,140,162.0,14},{579,140,171.0,14},{580,140,180.0,14},{581,140,189.0,14},{582,140,198.0,14},{583,140,207.0,14},{584,140,216.0,14},{585,140,225.0,14},{586,140,234.0,14},{587,140,243.0,14},{588,140,252.0,14},{589,140,261.0,14},{590,140,270.0,14},{591,140,279.0,14},{592,140,288.0,14},{593,140,297.0,14},{594,140,306.0,14},{595,140,315.0,14},{596,140,324.0,14},{597,140,333.0,14},{598,140,342.0,14},{599,140,351.0,14}},{{600,150,4.5,15},{601,150,13.5,15},{602,150,22.5,15},{603,150,31.5,15},{604,150,40.5,15},{605,150,49.5,15},{606,150,58.5,15},{607,150,67.5,15},{608,150,76.5,15},{609,150,85.5,15},{610,150,94.5,15},{611,150,103.5,15},{612,150,112.5,15},{613,150,121.5,15},{614,150,130.5,15},{615,150,139.5,15},{616,150,148.5,15},{617,150,157.5,15},{618,150,166.5,15},{619,150,175.5,15},{620,150,184.5,15},{621,150,193.5,15},{622,150,202.5,15},{623,150,211.5,15},{624,150,220.5,15},{625,150,229.5,15},{626,150,238.5,15},{627,150,247.5,15},{628,150,256.5,15},{629,150,265.5,15},{630,150,274.5,15},{631,150,283.5,15},{632,150,292.5,15},{633,150,301.5,15},{634,150,310.5,15},{635,150,319.5,15},{636,150,328.5,15},{637,150,337.5,15},{638,150,346.5,15},{639,150,355.5,15}},{{640,160,0.0,16},{641,160,9.0,16},{642,160,18.0,16},{643,160,27.0,16},{644,160,36.0,16},{645,160,45.0,16},{646,160,54.0,16},{647,160,63.0,16},{648,160,72.0,16},{649,160,81.0,16},{650,160,90.0,16},{651,160,99.0,16},{652,160,108.0,16},{653,160,117.0,16},{654,160,126.0,16},{655,160,135.0,16},{656,160,144.0,16},{657,160,153.0,16},{658,160,162.0,16},{659,160,171.0,16},{660,160,180.0,16},{661,160,189.0,16},{662,160,198.0,16},{663,160,207.0,16},{664,160,216.0,16},{665,160,225.0,16},{666,160,234.0,16},{667,160,243.0,16},{668,160,252.0,16},{669,160,261.0,16},{670,160,270.0,16},{671,160,279.0,16},{672,160,288.0,16},{673,160,297.0,16},{674,160,306.0,16},{675,160,315.0,16},{676,160,324.0,16},{677,160,333.0,16},{678,160,342.0,16},{679,160,351.0,16}},{{680,170,4.5,17},{681,170,13.5,17},{682,170,22.5,17},{683,170,31.5,17},{684,170,40.5,17},{685,170,49.5,17},{686,170,58.5,17},{687,170,67.5,17},{688,170,76.5,17},{689,170,85.5,17},{690,170,94.5,17},{691,170,103.5,17},{692,170,112.5,17},{693,170,121.5,17},{694,170,130.5,17},{695,170,139.5,17},{696,170,148.5,17},{697,170,157.5,17},{698,170,166.5,17},{699,170,175.5,17},{700,170,184.5,17},{701,170,193.5,17},{702,170,202.5,17},{703,170,211.5,17},{704,170,220.5,17},{705,170,229.5,17},{706,170,238.5,17},{707,170,247.5,17},{708,170,256.5,17},{709,170,265.5,17},{710,170,274.5,17},{711,170,283.5,17},{712,170,292.5,17},{713,170,301.5,17},{714,170,310.5,17},{715,170,319.5,17},{716,170,328.5,17},{717,170,337.5,17},{718,170,346.5,17},{719,170,355.5,17}}};

  NodeContainer nodes;
  nodes.Create (720);
  MobilityHelper mobility;

  mobility.SetMobilityModel ("ns3::LEOSatelliteMobilityModel");
  mobility.InstallAll ();

  int index = 0;
  for (NodeContainer::Iterator j = nodes.Begin ();j != nodes.End (); ++j){
      Ptr<Node> object = *j;
      Ptr<LEOSatelliteMobilityModel> position = object->GetObject<LEOSatelliteMobilityModel> ();
      position->setFileName("oneWeb-2021-3-9.txt");// @suppress("Invalid arguments") // 记录卫星运动的文件名
      position->setEnableRouting(false); // @suppress("Invalid arguments") // 此函数要比SetSatSphericalPos先调用
      // 设置每个卫星的初始位置
      struct LEOSatPolarPos pPos;
      pPos.altitude = ALTITUDE;
      pPos.longitude =  iridiumConstellation[index/40][index%40][1];
      pPos.alpha =  iridiumConstellation[index/40][index%40][2];
      pPos.inclination =  INCLINATION;
      pPos.plane =  iridiumConstellation[index/40][index%40][3];
      pPos.self = nodes.Get(index);
      pPos.index = index;
      position->SetSatSphericalPos(pPos); // @suppress("Invalid arguments")
      position->setRoutingAlgorithmAndSnapShotWay(2, 1); // @suppress("Invalid arguments")
      NS_ASSERT (position != 0);
      index++;
    }
//  Config::Connect ("/NodeList/*/$ns3::MobilityModel/CourseChange",
//                   MakeCallback (&CourseChange));

  Simulator::Stop (Seconds (2000.0));

  Simulator::Run ();
  Simulator::Destroy ();
  return 0;
}

